---
layout: post
title: Reactive Jersey Client using Java 8, RxJava and Netflix Hystrix
date: '2015-01-17T00:31:00.000+01:00'
author: Libor Kramoliš
tags:
- hystrix
- jaxrs
- reactive
- jersey
- rxjava
modified_time: '2015-01-17T00:43:46.733+01:00'
blogger_id: tag:blogger.com,1999:blog-2759548145050416517.post-8215724180746528848
blogger_orig_url: http://yatel.kramolis.cz/2015/01/reactive-jersey-client-rxjava-hystrix.html
---

In this post I will show you how to use <b><a href="https://jersey.java.net/" target="_blank">Jersey</a></b> Client Reactive API, it's&nbsp;<b><a href="https://github.com/ReactiveX/RxJava" target="_blank">RxJava</a>&nbsp;<a href="http://reactivex.io/RxJava/javadoc/rx/Observable.html" target="_blank">Observable</a></b>&nbsp;support together with&nbsp;<b>Netflix&nbsp;<a href="https://github.com/Netflix/Hystrix" target="_blank">Hystrix</a></b>, latency and fault tolerance library. All sources are placed in GitHub&nbsp;<a href="https://github.com/shamoh/jersey--examples--rx-client-java8-webapp" target="_blank">jersey--examples--rx-client-java8-webapp</a>&nbsp;project.<br /><br /><b>Jersey<span id="goog_441710426"></span><span id="goog_441710427"></span><a href="https://draft.blogger.com/"></a></b> framework contains <b>Reactive Client API</b>. Reactive Jersey Client API is a generic API allowing end users to utilize the popular reactive programming model when using Jersey Client. Reactive programming is very popular these days. <b>It helps you to implement asynchronous code with solved&nbsp;<a href="http://www.infoq.com/research/tackling-async-callback-hell" target="_blank">callback hell</a>&nbsp;issue.</b><br /><h3><br /></h3><h3>Jersey</h3>Jersey supports <b>RxJava Observable</b>,&nbsp;<b>Java 8 CompletionStage</b> and <b>CompletableFuture</b>,&nbsp;<b>Guava ListenableFuture</b> and <b>Futures</b>,&nbsp;<b>JSR-166e CompletableFuture</b>. It also provides <b>SPI</b> to be extended by custom reactive libraries.<br /><br />There is excellent 3 part blog post series written by <b><a href="https://plus.google.com/u/0/114019189542073327992/about" target="_blank">Michal Gajdoš</a></b> about Reactive Jersey Client:<br /><ol><li><a href="http://blog.dejavu.sk/2015/01/07/reactive-jersey-client-part-1-motivation/" target="_blank">Reactive Jersey Client – Motivation</a></li><li><a href="http://blog.dejavu.sk/2015/01/07/reactive-jersey-client-part-2-usage-and-supported-reactive-libraries/" target="_blank">Reactive Jersey Client – Usage and Supported Reactive Libraries</a></li><li><a href="http://blog.dejavu.sk/2015/01/07/reactive-jersey-client-part-3-customization/" target="_blank">Reactive Jersey Client – Customization (SPI)</a></li></ol><br /><a href="https://github.com/jersey/jersey" target="_blank">Jersey</a> source code contains also examples for supported reactive libraries, see modules:<br /><ul><li><a href="https://github.com/jersey/jersey/tree/master/examples/rx-client-webapp" target="_blank">examples/rx-client-webapp</a>&nbsp;-&nbsp;Jersey Reactive Client Extension WebApp Example.</li><li><a href="https://github.com/jersey/jersey/tree/master/examples/rx-client-java8-webapp" target="_blank">examples/rx-client-java8-webapp</a>&nbsp;-&nbsp;Jersey Reactive Client Extension (Java8) WebApp Example.</li></ul><h3><br /></h3><h3>Hystrix</h3><div><i>Hystrix is a latency and fault tolerance library designed to isolate points of access to remote systems, services and 3rd party libraries, stop cascading failure and enable resilience in complex distributed systems where failure is inevitable.</i></div><div><br /></div><div>You usually use Hystrix to isolate dependent system call into <a href="http://netflix.github.io/Hystrix/javadoc/com/netflix/hystrix/HystrixCommand.html" target="_blank"><b>HystrixCommand</b></a> class. It allows to be executed&nbsp;<a href="http://netflix.github.io/Hystrix/javadoc/com/netflix/hystrix/HystrixCommand.html#execute()" target="_blank">synchronously</a>, <a href="http://netflix.github.io/Hystrix/javadoc/com/netflix/hystrix/HystrixCommand.html#queue()" target="_blank">asynchronously</a>&nbsp;(returns java.util.concurrent.<b>Future</b>) and also <a href="http://netflix.github.io/Hystrix/javadoc/com/netflix/hystrix/HystrixCommand.html#observe()" target="_blank">asynchronously via RxJava Observable</a>.</div> <br /><h3>Code</h3>In case dependent system already supports RxJava Observable API you can use specific <b><a href="https://github.com/Netflix/Hystrix/blob/master/hystrix-core/src/main/java/com/netflix/hystrix/HystrixObservableCommand.java" target="_blank">HystrixObservableCommand</a></b> class. And thanks to Jersey Reactive Client API and its RxJava support it allows us to write&nbsp;resilient JAX-RS client code.</u><br /><br /><pre>private class <u>ForecastCommand</u> extends <u><i>HystrixObservableCommand</i></u>&lt;Forecast&gt; {<br />    private final Destination destination;<br />    ...<br />    @Override<br />    protected Observable&lt;Forecast&gt; <u>run</u>() {<br />        return <u>RxObservable</u>.from(forecastWebTarget)<br />                .resolveTemplate("destination", destination.getDestination())<br />                .request().<u>rx</u>()<br />                .get(Forecast.class);<br />    }<br />    @Override<br />    protected Observable&lt;Forecast&gt; <u>getFallback</u>() {<br />        return Observable.just(new Forecast(destination.getDestination(), "<i>N/A</i>"));<br />    }<br />}</pre><br />The code above creates new Hystrix RxJava Observable ready Command that invokes remote REST API using Jersey Reactive Client API. Whenever API call fails or times out a <i>getFallback()</i> method is invoked. And in this case we return Forecast instance with <i>N/A</i> forecast value.<br /><br />Whole example web application enhanced by code using Hystrix is placed into my GitHub <a href="https://github.com/shamoh/jersey--examples--rx-client-java8-webapp" target="_blank">jersey--examples--rx-client-java8-webapp</a>&nbsp;repository. Shown and little but simplified code snipped is from&nbsp;<a href="https://github.com/shamoh/jersey--examples--rx-client-java8-webapp/blob/master/src/main/java/org/glassfish/jersey/examples/rx/agent/HystrixObservableAgentResource.java#L77" target="_blank">HystrixObservableAgentResource</a>&nbsp;class. The example module is clone of&nbsp;<i>rx-client-java8-webapp</i>.<br /><br />To run the example:<br /><pre><br />    <i>mvn clean package jetty:run</i><br /></pre><br />At beginning of <i>HystrixObservableAgentResource</i> class there are <i>TIMEOUT_*</i> constants. You can play with values and you will see that sometimes you don't get all domain objects' values and sometimes you see default values (<i>N/A</i> for&nbsp;<i>Forecast</i> and <i>-1</i> for&nbsp;<i>Calculation</i>). You can also play with <i>Thread.sleep</i> intervals but because of Hystrix timeout support the overall JAX-RS resource method processing time is never (too much) longer than&nbsp;<i>TIMEOUT_OVERALL</i> (currently 900 ms).<br /><br />You can also check unit test&nbsp;<a href="https://github.com/shamoh/jersey--examples--rx-client-java8-webapp/blob/master/src/test/java/org/glassfish/jersey/examples/rx/RxClientsTest.java#L148" target="_blank">RxClientsTest</a>. Processing time is expected between 850 and 950 ms!<br /><h3><br /></h3><h3>Links</h3><div><br /></div><div><ul><li><a href="https://github.com/Netflix/Hystrix">https://github.com/Netflix/Hystrix</a> - Hystrix GitHub</li><li><a href="https://github.com/Netflix/Hystrix/wiki">https://github.com/Netflix/Hystrix/wiki</a> - Hystrix GitHub Wiki</li><li><a href="http://netflix.github.io/Hystrix/javadoc/">http://netflix.github.io/Hystrix/javadoc/</a> - Hystrix Javadoc</li><li><a href="https://jersey.java.net/documentation/latest/rx-client.html">https://jersey.java.net/documentation/latest/rx-client.html</a> - Jersey User Guide: Reactive Jersey Client API</li><li><a href="http://reactivex.io/RxJava/javadoc/">http://reactivex.io/RxJava/javadoc/</a> - RxJava Javadoc</li><li><a href="http://blogs.microsoft.co.il/bnaya/2010/02/25/rx-for-beginners-toc/">http://blogs.microsoft.co.il/bnaya/2010/02/25/rx-for-beginners-toc/</a> - Microsoft Blog: Rx&nbsp;for beginners</li><li><a href="https://speakerdeck.com/benjchristensen/reactive-streams-with-rx-at-javaone-2014">https://speakerdeck.com/benjchristensen/reactive-streams-with-rx-at-javaone-2014</a> -&nbsp;<b>Ben Christensen</b>'s&nbsp;Reactive Streams with Rx at JavaOne 2014 slides</li><li><a href="https://www.parleys.com/play/543f8d5be4b06e1184ae4106/about">https://www.parleys.com/play/543f8d5be4b06e1184ae4106/about</a> - Ben Christensen's&nbsp;<b>Reactive Streams</b> with Rx at JavaOne 2014 presentation</li></ul></div><br /><br /><br />